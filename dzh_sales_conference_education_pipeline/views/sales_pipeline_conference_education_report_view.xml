<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <data>

        <!--# REPORT-->
        <report
            id="action_sales_pipeline_conference_education_report"
            model="sales.pipeline.conference.education.report"
            string="Sales Conference &amp; Education Report"
            name="dzh_sales_conference_education_pipeline.sale_pipeline_conference_education_report"
            file="dzh_sales_conference_education_pipeline.sale_pipeline_conference_education_report"
            report_type="qweb-pdf"/>

        <record id="report_sales_pipeline_conference_education_qweb_paperformat" model="report.paperformat">
            <field name="name">Sales Revenue</field>
            <field name="default" eval="True"/>
            <field name="format">custom</field>
            <field name="page_height">297</field>
            <field name="page_width">210</field>
            <field name="orientation">Landscape</field>
            <field name="margin_top">30</field>
            <field name="margin_bottom">23</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">20</field>
            <field name="dpi">90</field>
        </record>

        <record id="action_sales_pipeline_conference_education_report" model="ir.actions.report.xml">
            <field name="paperformat_id" ref="report_sales_pipeline_conference_education_qweb_paperformat"/>
        </record>

        <!-- Headers and Footers for Credit Note Report -->
        <template id="external_layout_sales_pipeline_conference_education">
            <!-- Multicompany -->
            <t t-if="not o and doc">
                <t t-set="o" t-value="doc"/>
            </t>
            <t t-if="o and 'company_id' in o">
                <t t-set="company" t-value="o.company_id"></t>
            </t>
            <t t-if="not o or not 'company_id' in o">
                <t t-set="company" t-value="res_company"></t>
            </t>

            <t t-call="dzh_sales_conference_education_pipeline.external_layout_header_sales_pipeline_conference_education" />
            <t t-raw="0" />
            <t t-call="dzh_sales_conference_education_pipeline.external_layout_footer_sales_pipeline_conference_education" />
        </template>

        <template id="dzh_sales_conference_education_pipeline.external_layout_header_sales_pipeline_conference_education">
            <div class="header">
                <div class="row">
                    <div>
                        <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="height:40px;width:160px;float:right"/>
                    </div>
                </div>
            </div>
        </template>

        <template id="dzh_sales_conference_education_pipeline.external_layout_footer_sales_pipeline_conference_education">
            <div class="footer" style="font-size:10pt;">
                <div class="row">
                    <div class="col-xs-12 text-center">
                        <div class="text-right" style="float:right">
                            <ul class="list-inline">
                                <li>Page:</li>
                                <li><span class="page"/></li>
                                <li>of</li>
                                <li><span class="topage"/></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </template>


        <template id="dzh_sales_conference_education_pipeline.sale_pipeline_conference_education_report">
            <t t-call="dzh_sales_conference_education_pipeline.external_layout_sales_pipeline_conference_education">
            <t t-call="report.html_container">
                <t t-foreach="docs" t-as="o">
                    <div class="page">
                        <table class="table table-bordered">
                            <thead style="background-color:#EEEEEE;display:table-header-group;display:none;">
                                <tr style="background-color:#0060a8;page-break-inside:avoid;">
                                    <th colspan="9" class="text-center">
                                        <t style="color:whitefont-size:20px:text-align:center;">Financial Solutions - Sales Pipeline (Corporate)</t>
                                    </th>
                                </tr>
                                <tr style="background-color:#95b3d7;page-break-inside:avoid;">
                                    <th>Company</th>
                                    <th>Country</th>
                                    <th>Account Manager</th>
                                    <th>Services/Solutions</th>
                                    <th>Potential Revenue Monthly</th>
                                    <th>Potential Revenue Annual</th>
                                    <th style="white-space:nowrap;">
                                        <span class="text-left">Start Date/</span>
                                        <span class="text-right">Billing</span>
                                    </th>
                                    <th>Probability</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background-color:#0060a8;page-break-inside:avoid;">
                                    <th colspan="9" class="text-center">
                                        <t style="color:whitefont-size:20px:text-align:center;">Conference &amp; Event - Sales Pipeline (Corporate)</t>
                                    </th>
                                </tr>
                                <div t-foreach="o.invoice_filter[0]" t-as="f">
                                    <t t-set="total_planned" t-value="0"/>
                                    <t t-set="annual_planned" t-value="0"/>
                                    <tr style="background-color:#95b3d7;page-break-inside:avoid;">
                                        <th>Company</th>
                                        <th>Country</th>
                                        <th>Account Manager</th>
                                        <th>Services/Solutions</th>
                                        <th>Potential Revenue Monthly</th>
                                        <th>Potential Revenue Annual</th>
                                        <th style="white-space:nowrap;">
                                            <span class="text-left">Start Date/</span>
                                            <span class="text-right">Billing</span>
                                        </th>
                                        <th>Probability</th>
                                        <th>Remarks</th>
                                    </tr>
                                    <tr style="page-break-inside:avoid;color:white;font-weight:700;background-color:#366092;">
                                        <td colspan="9">
                                            <span style="text-transform:uppercase;" t-esc="f"></span>
                                        </td>
                                    </tr>
                                    <tr t-foreach="o.invoice_ids" t-as="invoice" style="page-break-inside:avoid;" t-if="invoice.id in o.invoice_filter[0][f]['ids']">


                                        <td>
                                            <span t-field="invoice.partner_id"/>
                                        </td>
                                        <td>
                                            <span t-field="invoice.partner_id and invoice.partner_id.country_id"/>
                                        </td>
                                        <td>
                                            <span t-field="invoice.user_id"/>
                                        </td>
                                        <td>
                                            <p t-foreach="invoice.partner_id and invoice.partner_id.opportunity_ids" t-as="op">
                                                <span t-field="op.name"></span>
                                            </p>
                                        </td>
                                        <td>
                                            <span t-field="invoice.planned_revenue"/>
                                            <t t-set="total_planned" t-value="total_planned + invoice.planned_revenue"/>
                                        </td>
                                        <td>
                                            <span t-field="invoice.annual_revenue"/>
                                            <t t-set="annual_planned" t-value="annual_planned + invoice.annual_revenue"/>
                                        </td>
                                        <td>
                                            <span style="white-space:nowrap;" t-field="invoice.x_subscription_period" t-field-options="{&quot;format&quot;: &quot;d-MMM-yy&quot;}" />
                                        </td>
                                        <td>
                                            <span t-field="invoice.probability"/>
                                        </td>
                                        <td>
                                            <span t-field="invoice.description"/>
                                        </td>
                                    </tr>
                                    <tr style="page-break-inside:avoid;background-color:#00b0f0;">
                                        <td colspan="3">
                                            <span t-esc="o.date_filter[0]" />
                                        </td>
                                        <td>
                                            <span t-esc="o.currency.name" />
                                        </td>
                                        <td>
                                            <span t-esc="o.currency.symbol" t-if="o.currency.position == 'before'"/>
                                            <span t-esc="'{0:,.2f}'.format(int(total_planned))"></span>
                                            <span t-esc="o.currency.symbol" t-if="o.currency.position == 'after'"/>
                                        </td>
                                        <td>
                                            <span t-esc="o.currency.symbol" t-if="o.currency.position == 'before'"/>
                                            <span t-esc="'{0:,.2f}'.format(int(annual_planned))"></span>
                                            <span t-esc="o.currency.symbol" t-if="o.currency.position == 'after'"/>
                                        </td>
                                        <td>
                                            <!--<span>SGD</span>-->
                                        </td>
                                        <td>
                                            <!--<span>SGD</span>-->
                                        </td>
                                        <td>
                                            <!--<span>SGD</span>-->
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan="10">  </td>
                                    </tr>
                                </div>
                            </tbody>
                        </table>
                    </div>
                </t>
            </t>
            </t>
        </template>


       <!--# SHOW POP UP-->
        <record id="sales_pipeline_conference_education_report_view" model="ir.ui.view">
            <field name="name">Sales Pipeline Conference Education</field>
            <field name="model">sales.pipeline.conference.education.report</field>
            <field name="arch" type="xml">
            <form string="Report Options" style="height:240px">
                <label string=""/>  <!-- binding for inherited views -->
                <group col="4">
                    <field name="country"/>
                    <field name="sales_person"/>
                    <field name="start_date" string="Start Date"/>
                    <field name="end_date" string="End Date"/>
                </group>
                <footer>
                    <button name="print_report" string="Print" type="object" default_focus="1" class="oe_highlight"/>
                    or
                    <button string="Cancel" class="oe_link" special="cancel" />
                </footer>
            </form>
            </field>
        </record>

        <record id="action_print_pipeline_conference_education_report" model="ir.actions.act_window">
            <field name="name">Sales Pipeline Conference Education</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sales.pipeline.conference.education.report</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
        </record>

        <menuitem id='menu_sales_pipeline_conference_education_report'
                  name='Sales Pipeline Conference &amp; Education Report'
                  parent="sales_team.menu_sale_report"
                  action="action_print_pipeline_conference_education_report"/>
    </data>
</odoo>
